buildscript {
    repositories {
        jcenter()
        maven {
            url "https://plugins.gradle.org/m2"
        }
    }
    dependencies {
        classpath "gradle.plugin.com.timberglund:asciidoctor-presentation:0.1.1"
    }
}
plugins {
    id "org.ajoberstar.git-publish" version "0.2.0"
}

apply plugin: "com.timberglund.presentation.plugin"
apply plugin: 'application'

repositories {
    jcenter()
}
dependencies {
    runtime 'me.champeau.deck2pdf:deck2pdf:0.3.0'
}

mainClassName = "me.champeau.deck2pdf.Main"
run {
    inputs.dir "src"
    outputs.file "$buildDir/slides.pdf"
    dependsOn tasks.presentation
    args "$buildDir/asciidoc/deckjs/slides.html", "$buildDir/slides.pdf"
}

task pdf {
    dependsOn run
}

presentation {
    modules {
        content {
            title = "The content"
            file = "content.adoc"
        }
    }
}

slides {
    headers = [
        deckjs_transition: 'fade',
        deckjs_theme: 'tschulte',
        blank: '',
        scale: '',
        navigation: '',
        menu: '',
        goto: '',
        split: '',
        status: '',
        toc: '',
    ]
    title = "Semantic Release"
    author = "Tobias Schulte"
}

lessc {
    sourceDir "src/styles"
    include "**/*.less"
    destinationDir = "${buildDir}/asciidoc/deckjs/deck.js/themes/style"
    mustRunAfter slides
}

gitPublish {
    repoUri = "git@github.com:tschulte/gradle-semantic-release-plugin-presentation"
    // branch will be created if it doesn't exist
    branch = 'gh-pages'

    // what to publish, this is a standard CopySpec
    contents {
        from "$buildDir/asciidoc/deckjs/"
    }
    // message used when committing changes
    commitMessage = 'Publishing a version of the presentation' // defaults to 'Generated by gradle-git-publish'
}
gitPublishCopy.dependsOn tasks.presentation
